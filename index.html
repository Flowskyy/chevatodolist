<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheva's To Do List</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            --accent-color: #8B5CF6;
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.6);
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --radius-xl: 24px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f3f4f6;
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        /* Blobs Animasi */
        .bg-blob { position: fixed; border-radius: 50%; filter: blur(80px); z-index: -1; opacity: 0.5; animation: float 10s infinite alternate; }
        .blob-1 { width: 400px; height: 400px; background: #c084fc; top: -100px; left: -100px; }
        .blob-2 { width: 300px; height: 300px; background: #60a5fa; bottom: -50px; right: -50px; animation-delay: -5s; }
        @keyframes float { 0% { transform: translate(0,0); } 100% { transform: translate(40px, 60px); } }

        .container {
            width: 90%; max-width: 550px; background: var(--glass-bg); backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: var(--radius-xl);
            box-shadow: 0 20px 50px rgba(0,0,0,0.1); padding: 2.5rem; position: relative;
        }

        header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem; }
        .brand-title { font-family: 'Outfit'; font-size: 2rem; font-weight: 800; line-height: 1.1; }
        .brand-highlight { background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .profile-btn { 
            background: white; border: none; width: 48px; height: 48px; border-radius: 14px; 
            cursor: pointer; display: flex; align-items: center; justify-content: center; 
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .profile-btn.active { background: var(--primary-gradient); color: white; transform: rotate(15deg); box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3); }

        /* Login Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.2); backdrop-filter: blur(10px); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-card { background: white; padding: 2.5rem; border-radius: 30px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 30px 60px rgba(0,0,0,0.2); }
        
        .pass-input-container { position: relative; margin: 1.5rem 0; }
        .pass-input-container input { width: 100%; padding: 14px 18px; padding-right: 50px; border-radius: 15px; border: 2px solid #f1f5f9; outline: none; background: #f8fafc; font-size: 1rem; }
        .pass-input-container i { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-gray); font-size: 1.2rem; }

        /* Admin Mode Components */
        .admin-section { display: none; background: rgba(255,255,255,0.5); padding: 1.5rem; border-radius: 20px; margin-bottom: 1.5rem; border: 1px dashed var(--accent-color); animation: slideDown 0.4s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .input-wrapper { display: flex; gap: 10px; margin-bottom: 12px; }
        .input-wrapper input { flex: 1; padding: 12px; border-radius: 12px; border: 1px solid #ddd; outline: none; }
        .btn { border: none; border-radius: 12px; cursor: pointer; font-weight: 600; padding: 10px 18px; transition: 0.3s; }
        .btn-add { background: var(--text-dark); color: white; }
        .admin-tools { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn-sm { font-size: 0.75rem; padding: 6px 12px; background: white; border: 1px solid #eee; }

        /* List Items */
        ul { list-style: none; display: flex; flex-direction: column; gap: 12px; }
        .todo-item { 
            background: rgba(255, 255, 255, 0.6); border: 1px solid white; padding: 16px; 
            border-radius: 18px; display: flex; align-items: center; transition: 0.3s;
        }
        .todo-item.completed { opacity: 0.5; }
        .todo-item.completed .task-text { text-decoration: line-through; }
        .task-text { flex: 1; margin: 0 15px; font-weight: 500; }
        
        /* Checkbox Custom */
        .checkbox-custom { appearance: none; width: 24px; height: 24px; border: 2px solid #cbd5e1; border-radius: 7px; cursor: pointer; position: relative; transition: 0.2s; }
        .checkbox-custom:checked { background: var(--accent-color); border-color: var(--accent-color); }
        .checkbox-custom:checked::after { content: 'âœ“'; color: white; position: absolute; inset: 0; display: flex; justify-content: center; align-items: center; font-size: 14px; }

        /* Item Actions (Hidden in View Mode) */
        .item-actions { display: none; gap: 8px; }
        .admin-mode .item-actions { display: flex; }
        .admin-mode .todo-item { border: 1px solid rgba(139, 92, 246, 0.2); background: white; }
        .action-icon { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; background: #f8fafc; color: var(--text-gray); }

        .btn-primary { background: var(--primary-gradient); color: white; width: 100%; padding: 14px; border-radius: 15px; border: none; font-weight: 700; cursor: pointer; font-size: 1rem; }
    </style>
</head>
<body>

    <div class="bg-blob blob-1"></div><div class="bg-blob blob-2"></div>

    <div id="loginModal" class="modal">
        <div class="modal-card">
            <h2 style="font-family:'Outfit'">Private Access</h2>
            <p style="color:var(--text-gray); font-size: 0.9rem; margin-top: 5px;">Silakan login untuk melihat list.</p>
            <div class="pass-input-container">
                <input type="password" id="loginPass" placeholder="Enter Password..." onkeypress="if(event.key==='Enter') attemptLogin()">
                <i class="ph ph-eye" id="toggleIcon" onclick="togglePass()"></i>
            </div>
            <button class="btn-primary" onclick="attemptLogin()">Buka List</button>
            <div id="loginErr" style="color: #ef4444; font-size: 0.8rem; margin-top: 10px; display: none;">Password salah, coba lagi.</div>
        </div>
    </div>

    <div class="container">
        <header>
            <div>
                <div class="brand-title"><span class="brand-highlight">Cheva's</span><br>To Do List</div>
                <div id="dateDisplay" style="font-size: 0.85rem; color: var(--text-gray); margin-top: 5px;"></div>
            </div>
            <button class="profile-btn" id="profileBtn" onclick="toggleAdminMode()">
                <i class="ph ph-user-focus" style="font-size: 24px;"></i>
            </button>
        </header>

        <div class="admin-section" id="adminPanel">
            <div class="input-wrapper">
                <input type="text" id="newTaskInput" placeholder="Ketik tugas baru...">
                <button class="btn btn-add" onclick="addTask()">Tambah</button>
            </div>
            <div class="admin-tools">
                <button class="btn btn-sm" onclick="apiCall('uncheck_all')"><i class="ph ph-arrow-counter-clockwise"></i> Reset Check</button>
                <button class="btn btn-sm" onclick="apiCall('clear_completed')"><i class="ph ph-broom"></i> Bersihkan Selesai</button>
                <button class="btn btn-sm" style="color:#ef4444" onclick="logout()"><i class="ph ph-sign-out"></i> Logout</button>
            </div>
        </div>

        <ul id="todoList"></ul>
    </div>

    <script>
        let tasks = [];
        let isAdminActive = false;

        async function init() {
            const res = await fetch('/api/api.php?action=get_all');
            const json = await res.json();
            if (json.status === 'success') {
                tasks = json.data;
                render();
            } else {
                document.getElementById('loginModal').style.display = 'flex';
            }
        }

        function togglePass() {
            const inp = document.getElementById('loginPass');
            const ico = document.getElementById('toggleIcon');
            if(inp.type === 'password') {
                inp.type = 'text';
                ico.className = 'ph ph-eye-closed';
            } else {
                inp.type = 'password';
                ico.className = 'ph ph-eye';
            }
        }

        async function attemptLogin() {
            const pass = document.getElementById('loginPass').value;
            const res = await fetch('/api/api.php?action=login', {
                method: 'POST',
                body: JSON.stringify({ password: pass })
            });
            const json = await res.json();
            if(json.status === 'success') location.reload();
            else document.getElementById('loginErr').style.display = 'block';
        }

        function toggleAdminMode() {
            isAdminActive = !isAdminActive;
            document.getElementById('adminPanel').style.display = isAdminActive ? 'block' : 'none';
            document.getElementById('profileBtn').classList.toggle('active', isAdminActive);
            render();
        }

        async function apiCall(action, data = {}) {
            await fetch(`/api/api.php?action=${action}`, {
                method: 'POST',
                body: JSON.stringify(data)
            });
            init();
        }

        function render() {
            const listEl = document.getElementById('todoList');
            listEl.className = isAdminActive ? 'admin-mode' : '';
            listEl.innerHTML = tasks.map((t, i) => `
                <li class="todo-item ${t.is_completed ? 'completed' : ''}">
                    <input type="checkbox" class="checkbox-custom" ${t.is_completed ? 'checked' : ''} onchange="apiCall('toggle', {id:${t.id}})">
                    <span class="task-text">${t.task_name}</span>
                    <div class="item-actions">
                        <div class="action-icon" onclick="move(${i}, -1)"><i class="ph ph-caret-up"></i></div>
                        <div class="action-icon" onclick="move(${i}, 1)"><i class="ph ph-caret-down"></i></div>
                        <div class="action-icon" style="color:#ef4444" onclick="apiCall('delete', {id:${t.id}})"><i class="ph ph-trash"></i></div>
                    </div>
                </li>
            `).join('');
        }

        function move(idx, dir) {
            if (idx + dir < 0 || idx + dir >= tasks.length) return;
            const t1 = tasks[idx], t2 = tasks[idx + dir];
            apiCall('swap', { id1: t1.id, order1: t1.list_order, id2: t2.id, order2: t2.list_order });
        }

        function addTask() {
            const inp = document.getElementById('newTaskInput');
            if(inp.value) { apiCall('add', {task: inp.value}); inp.value = ''; }
        }

        function logout() { fetch('/api/api.php?action=logout').then(() => location.reload()); }

        // Set Date
        const options = { weekday: 'long', day: 'numeric', month: 'long' };
        document.getElementById('dateDisplay').innerText = new Date().toLocaleDateString('id-ID', options);

        init();
    </script>
</body>
</html>