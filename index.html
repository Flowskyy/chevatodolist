<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cheva's Ultimate List</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config={darkMode:'class',theme:{extend:{fontFamily:{sans:['"Plus Jakarta Sans"','sans-serif'],display:['"Outfit"','sans-serif']},colors:{primary:'#6366f1',accent:'#8B5CF6'},animation:{'blob':'floatBlob 10s infinite alternate','pop':'popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)','slide-up':'slideInUp 0.4s ease backwards','slide-down':'slideDown 0.3s ease','bounce-in':'bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55)','pulse-slow':'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite'}}}}</script>
    <style>@keyframes floatBlob{0%{transform:translate(0,0) scale(1)}100%{transform:translate(30px,50px) scale(1.1)}}@keyframes popIn{from{transform:scale(0.9);opacity:0}to{transform:scale(1);opacity:1}}@keyframes popCheck{0%{transform:scale(1)}50%{transform:scale(1.2)}100%{transform:scale(1)}}@keyframes slideInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes bounceIn{0%{transform:scale(0.3);opacity:0}50%{transform:scale(1.05)}70%{transform:scale(0.9)}100%{transform:scale(1);opacity:1}}.custom-checkbox:checked{animation:popCheck 0.3s cubic-bezier(0.34,1.56,0.64,1)}.custom-checkbox::after{content:'';width:6px;height:10px;border:solid white;border-width:0 2.5px 2.5px 0;transform:rotate(45deg) scale(0);transition:transform 0.2s ease-in-out;position:absolute;top:50%;left:50%;margin-top:-6px;margin-left:-3px}.custom-checkbox:checked::after{transform:rotate(45deg) scale(1)}.mode-teaser .blur-target{filter:blur(8px);pointer-events:none;opacity:0.6;user-select:none}.no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}.timer-ring{transform:rotate(-90deg);transform-origin:50% 50%}</style>
</head>
<body class="bg-gray-100 dark:bg-slate-900 text-slate-800 dark:text-slate-100 min-h-screen flex justify-center items-start pt-16 pb-20 transition-colors duration-300 mode-teaser overflow-x-hidden selection:bg-accent selection:text-white">
    <div class="fixed top-[-100px] left-[-100px] w-96 h-96 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-60 animate-blob -z-10"></div>
    <div class="fixed bottom-[-50px] right-[-50px] w-80 h-80 bg-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-60 animate-blob animation-delay-2000 -z-10"></div>
    <audio id="sound-check" src="https://assets.mixkit.co/sfx/preview/mixkit-modern-technology-select-3124.mp3"></audio>
    <audio id="sound-complete" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
    <audio id="sound-cheer" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>
    <audio id="sound-timer" src="https://assets.mixkit.co/sfx/preview/mixkit-clock-countdown-bleeps-916.mp3"></audio>
    <audio id="sound-timer-end" src="https://assets.mixkit.co/sfx/preview/mixkit-bell-notification-933.mp3"></audio>
    
    <div id="pomodoroModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-50 hidden justify-center items-center p-4"><div class="bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-2xl w-full max-w-sm text-center border border-white/20 animate-pop"><div class="flex justify-between items-center mb-6"><h2 class="font-display text-xl font-bold">üçÖ Pomodoro Timer</h2><button onclick="closePomodoroModal()" class="w-8 h-8 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center justify-center transition"><i class="ph-bold ph-x text-xl text-slate-400"></i></button></div><div class="relative w-48 h-48 mx-auto mb-6"><svg class="w-full h-full"><circle cx="96" cy="96" r="88" fill="none" stroke="currentColor" stroke-width="8" class="text-slate-200 dark:text-slate-700"/><circle id="timerCircle" cx="96" cy="96" r="88" fill="none" stroke="currentColor" stroke-width="8" class="text-accent timer-ring transition-all duration-1000" stroke-dasharray="552.92" stroke-dashoffset="0" stroke-linecap="round"/></svg><div class="absolute inset-0 flex flex-col items-center justify-center"><p id="timerDisplay" class="font-display text-4xl font-bold">25:00</p><p id="timerTask" class="text-xs text-slate-500 mt-2 max-w-[150px] truncate"></p></div></div><div class="flex gap-3 justify-center mb-4"><button id="timerStartBtn" onclick="startPomodoro()" class="px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-bold shadow-lg hover:shadow-indigo-500/30 transition"><i class="ph-bold ph-play"></i> Start</button><button id="timerPauseBtn" onclick="pausePomodoro()" class="hidden px-6 py-3 rounded-xl bg-amber-500 text-white font-bold shadow-lg transition"><i class="ph-bold ph-pause"></i> Pause</button><button onclick="resetPomodoro()" class="px-6 py-3 rounded-xl bg-slate-100 dark:bg-slate-700 font-semibold text-slate-600 dark:text-slate-300 hover:bg-slate-200 transition"><i class="ph-bold ph-arrow-counter-clockwise"></i></button></div><div class="flex gap-2 justify-center text-xs"><button onclick="setTimer(25)" class="px-3 py-1 rounded-lg bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400 font-semibold hover:bg-indigo-100 transition">25m</button><button onclick="setTimer(15)" class="px-3 py-1 rounded-lg bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-300 font-semibold hover:bg-slate-200 transition">15m</button><button onclick="setTimer(5)" class="px-3 py-1 rounded-lg bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-300 font-semibold hover:bg-slate-200 transition">5m</button></div></div></div>

    <div id="motivationToast" class="fixed top-8 left-1/2 -translate-x-1/2 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-4 rounded-2xl shadow-2xl z-50 opacity-0 pointer-events-none transition-all duration-500 transform -translate-y-4 flex items-center gap-3 max-w-md"><i class="ph-fill ph-check-circle text-3xl animate-bounce-in"></i><div><p class="font-bold text-sm">Mantap, Cheva! üéâ</p><p id="motivationText" class="text-xs opacity-90"></p></div></div>
    <div id="successToast" class="fixed bottom-8 right-8 bg-white dark:bg-slate-800 border-l-4 border-green-500 px-5 py-3 rounded-xl shadow-2xl z-50 opacity-0 pointer-events-none transition-all duration-300 transform translate-x-full flex items-center gap-3 max-w-sm"><i class="ph-fill ph-check-circle text-2xl text-green-500"></i><div><p class="font-bold text-sm text-slate-800 dark:text-slate-100">Berhasil!</p><p id="successMessage" class="text-xs text-slate-600 dark:text-slate-400"></p></div></div>
    <div id="streakToast" class="fixed top-8 left-1/2 -translate-x-1/2 bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-4 rounded-2xl shadow-2xl z-50 opacity-0 pointer-events-none transition-all duration-500 transform -translate-y-4 flex items-center gap-3 max-w-md"><i class="ph-fill ph-fire text-3xl animate-bounce-in"></i><div><p class="font-bold text-sm">Streak Updated! üî•</p><p id="streakText" class="text-xs opacity-90"></p></div></div>
    
    <div id="focusSelectorModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-50 hidden justify-center items-center p-4"><div class="bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-2xl w-full max-w-md border border-white/20 animate-pop"><div class="flex items-center justify-between mb-6"><div class="flex items-center gap-3"><div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-xl flex items-center justify-center"><i class="ph-bold ph-target text-2xl text-white"></i></div><div><h2 class="font-display text-xl font-bold">Focus Mode</h2><p class="text-xs text-slate-500">Pilih tugas untuk fokus</p></div></div><button onclick="closeFocusSelector()" class="w-8 h-8 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center justify-center transition"><i class="ph-bold ph-x text-xl text-slate-400"></i></button></div><div id="focusTaskList" class="flex flex-col gap-2 mb-6 max-h-80 overflow-y-auto no-scrollbar"></div><button onclick="closeFocusSelector()" class="w-full py-3 rounded-xl bg-slate-100 dark:bg-slate-700 font-semibold text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition">Batal</button></div></div>
    
    <div id="dueDateModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-50 hidden justify-center items-center p-4"><div class="bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-2xl w-full max-w-sm border border-white/20 animate-pop"><h2 class="font-display text-xl font-bold mb-4">Set Deadline</h2><p id="dueDateTaskName" class="text-sm text-slate-500 mb-4"></p><input type="date" id="dueDateInput" class="w-full p-3 rounded-xl border-2 border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 outline-none focus:border-accent transition-colors mb-4"><div class="flex gap-3"><button onclick="closeDueDateModal()" class="px-6 py-3 rounded-xl bg-slate-100 dark:bg-slate-700 font-semibold text-slate-500 hover:bg-slate-200 transition">Batal</button><button onclick="saveDueDate()" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-bold shadow-lg hover:shadow-indigo-500/30 transition">Simpan</button></div></div></div>
    
    <div id="loginModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-50 hidden justify-center items-center p-4"><div class="bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-2xl w-full max-w-sm text-center border border-white/20 animate-pop"><h2 class="font-display text-2xl font-bold mb-2">Admin Access</h2><p class="text-slate-500 text-sm mb-6">Masukkan password untuk kelola tugas.</p><div class="relative mb-4"><input type="password" id="passwordInput" placeholder="Password..." class="w-full p-4 rounded-xl border-2 border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 outline-none focus:border-accent transition-colors" onkeypress="if(event.key==='Enter')attemptLogin()"><i class="ph ph-eye absolute right-4 top-1/2 -translate-y-1/2 text-xl text-slate-400 cursor-pointer" id="eyeIcon" onclick="togglePass()"></i></div><p id="errorMsg" class="text-red-500 text-sm mb-4 hidden">Password salah, coba lagi!</p><div class="flex gap-3"><button onclick="closeModal()" class="px-6 py-3 rounded-xl bg-slate-100 dark:bg-slate-700 font-semibold text-slate-500 hover:bg-slate-200 transition">Batal</button><button onclick="attemptLogin()" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-bold shadow-lg hover:shadow-indigo-500/30 transition transform active:scale-95">Login</button></div></div></div>

    <div class="w-[92%] max-w-[500px] relative transition-all duration-500">
        <div id="teaserOverlay" class="absolute inset-0 z-40 hidden flex-col justify-center items-center text-center"><div class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-md p-8 rounded-3xl shadow-xl border border-white/50"><i class="ph-duotone ph-lock-key text-6xl text-accent mb-4"></i><h2 class="font-display text-2xl font-bold mb-4 leading-tight">Cheva,<br>Login dulu yuk!</h2><button onclick="openLogin()" class="px-8 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl font-bold shadow-lg hover:scale-105 transition">Login Sekarang</button></div></div>
        <div class="bg-white/65 dark:bg-slate-900/60 backdrop-blur-xl border border-white/60 dark:border-white/10 shadow-[0_8px_32px_0_rgba(31,38,135,0.1)] rounded-[32px] p-6 sm:p-10 blur-target transition-all duration-300">
            <header class="flex justify-between items-start mb-6"><div><h1 class="font-display text-3xl font-extrabold leading-none tracking-tight"><span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 to-purple-500">Cheva's</span><br>To Do List</h1><div id="dateDisplay" class="text-slate-500 dark:text-slate-400 text-sm font-semibold mt-1"></div></div><div class="flex gap-2"><button onclick="toggleFocusMode()" id="focusBtn" class="w-10 h-10 rounded-xl bg-white dark:bg-slate-700 border border-slate-100 dark:border-slate-600 flex items-center justify-center text-slate-500 hover:text-accent hover:shadow-md transition" title="Focus Mode"><i class="ph-bold ph-target text-xl"></i></button><button onclick="toggleDarkMode()" class="w-10 h-10 rounded-xl bg-white dark:bg-slate-700 border border-slate-100 dark:border-slate-600 flex items-center justify-center text-slate-500 hover:text-yellow-500 hover:shadow-md transition" title="Theme"><i class="ph-bold ph-moon-stars text-xl" id="themeIcon"></i></button><button onclick="toggleEditMode()" id="profileBtn" class="w-10 h-10 rounded-xl bg-white dark:bg-slate-700 border border-slate-100 dark:border-slate-600 flex items-center justify-center text-slate-500 hover:text-indigo-500 hover:shadow-md transition" title="Admin"><i class="ph-bold ph-user-focus text-xl"></i></button></div></header>
            
            <div id="streakBadge" class="mb-6 bg-gradient-to-r from-orange-500 to-red-500 p-4 rounded-2xl text-white flex items-center justify-between shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showStreakDetail()"><div class="flex items-center gap-3"><div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center animate-pulse-slow"><i class="ph-fill ph-fire text-2xl"></i></div><div><p class="text-xs font-semibold opacity-90">Current Streak</p><p class="font-display text-2xl font-bold"><span id="currentStreak">0</span> days üî•</p></div></div><div class="text-right"><p class="text-xs font-semibold opacity-90">Best</p><p class="font-bold text-lg"><span id="longestStreak">0</span> days</p></div></div>
            
            <div class="mb-6"><div class="flex justify-between text-xs font-bold text-slate-400 mb-2 uppercase tracking-wide"><span>Daily Progress</span><span id="progressText">0%</span></div><div class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden"><div id="progressBar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 w-0 transition-all duration-700 ease-out rounded-full"></div></div></div>
            <div class="relative mb-6 group"><i class="ph ph-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-accent transition-colors"></i><input type="text" id="searchInput" placeholder="Cari tugas..." oninput="render()" class="w-full pl-11 pr-4 py-3 bg-slate-50 dark:bg-slate-800 border-2 border-transparent focus:border-accent rounded-xl outline-none text-sm transition-all shadow-sm"></div>
            
            <div id="adminPanel" class="hidden flex-col gap-4 mb-6 bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm animate-slide-up"><div class="flex gap-2"><input type="text" id="newTaskInput" placeholder="Tulis tugas baru..." autocomplete="off" class="flex-1 px-4 py-3 bg-slate-50 dark:bg-slate-700 rounded-xl outline-none border-2 border-slate-100 dark:border-slate-600 focus:border-accent text-sm" onkeypress="if(event.key==='Enter')addTask()"><button onclick="addTask()" class="w-12 h-12 flex-shrink-0 bg-slate-800 dark:bg-white text-white dark:text-slate-900 rounded-xl flex items-center justify-center hover:scale-105 transition shadow-lg"><i class="ph-bold ph-plus text-xl"></i></button></div><div class="flex items-center gap-3 px-1"><span class="text-xs text-slate-400 font-bold">TAG:</span><div class="flex gap-2"><label class="cursor-pointer group relative"><input type="radio" name="cat" value="transparent" checked class="peer sr-only"><div class="w-6 h-6 rounded-full bg-slate-200 border-2 border-transparent peer-checked:border-slate-500 peer-checked:scale-110 transition"></div></label><label class="cursor-pointer group relative"><input type="radio" name="cat" value="#ef4444" class="peer sr-only"><div class="w-6 h-6 rounded-full bg-red-500 border-2 border-transparent peer-checked:border-slate-800 dark:peer-checked:border-white peer-checked:scale-110 transition"></div></label><label class="cursor-pointer group relative"><input type="radio" name="cat" value="#3b82f6" class="peer sr-only"><div class="w-6 h-6 rounded-full bg-blue-500 border-2 border-transparent peer-checked:border-slate-800 dark:peer-checked:border-white peer-checked:scale-110 transition"></div></label><label class="cursor-pointer group relative"><input type="radio" name="cat" value="#10b981" class="peer sr-only"><div class="w-6 h-6 rounded-full bg-emerald-500 border-2 border-transparent peer-checked:border-slate-800 dark:peer-checked:border-white peer-checked:scale-110 transition"></div></label></div></div><div class="flex flex-wrap gap-2 justify-end pt-2 border-t border-slate-100 dark:border-slate-700"><button onclick="apiCallWithConfirm('uncheck_all',{},'Uncheck semua tugas?')" class="text-xs font-semibold px-3 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition flex items-center gap-1"><i class="ph-bold ph-arrow-counter-clockwise"></i> Uncheck</button><button onclick="apiCallWithConfirm('clear_completed',{},'Hapus semua tugas yang selesai?')" class="text-xs font-semibold px-3 py-2 bg-amber-50 text-amber-600 rounded-lg hover:bg-amber-100 transition flex items-center gap-1"><i class="ph-bold ph-broom"></i> Clear Done</button><button onclick="apiCallWithConfirm('reset',{},'Reset semua tugas?')" class="text-xs font-semibold px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center gap-1"><i class="ph-bold ph-trash"></i> Reset</button><button onclick="logout()" class="text-xs font-semibold px-3 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 transition ml-auto flex items-center gap-1"><i class="ph-bold ph-sign-out"></i> Logout</button></div></div>
            
            <ul id="todoList" class="flex flex-col gap-3 min-h-[50px] pb-4"></ul>
            <div id="emptyState" class="hidden text-center py-10"><div class="inline-flex justify-center items-center w-20 h-20 bg-slate-50 dark:bg-slate-800 rounded-full mb-4 shadow-inner"><i class="ph-duotone ph-confetti text-4xl text-slate-300"></i></div><p class="font-bold text-lg mb-1">Tugas Selesai!</p><p id="quoteText" class="text-sm text-slate-400 italic">"Stay productive, stay happy."</p></div>
            <div id="focusStateMsg" class="hidden text-center py-8"><p class="text-sm text-accent font-bold bg-accent/10 inline-block px-3 py-1 rounded-full animate-pulse">üéØ Focus Mode Active</p><p id="focusTaskName" class="text-slate-600 dark:text-slate-400 text-sm mt-2"></p></div>
        </div>
    </div>

    <script>
        let tasks=[],isLoggedIn=false,isEditMode=false,isFocusMode=false,focusTaskId=null,sortableInstance=null,streakData={current:0,longest:0,last_date:null},pomodoroInterval=null,pomodoroSeconds=1500,pomodoroTotalSeconds=1500,pomodoroTaskId=null,isPomodoroRunning=false,currentDueDateTaskId=null;
        const soundCheck=document.getElementById('sound-check'),soundComplete=document.getElementById('sound-complete'),soundCheer=document.getElementById('sound-cheer'),soundTimer=document.getElementById('sound-timer'),soundTimerEnd=document.getElementById('sound-timer-end');
        const quotes=["Mulai dari yang kecil, selesaikan yang besar.","Fokus satu persatu, jangan panik.","You are doing great, Cheva!","Disiplin adalah kunci.","Istirahat itu perlu, menyerah jangan."];
        const motivationalQuotes=["Satu langkah lebih dekat ke tujuan! üí™","Produktivitas level expert nih! ‚≠ê","Keep going, kamu luar biasa! üöÄ","Progress is progress, no matter how small! üéØ","Konsistensi adalah kunci kesuksesan! üî•","Every task completed is a win! üèÜ","Kamu makin dekat sama goals! üíé","Small steps, big results! ‚ú®"];
        
        function openPomodoroModal(taskId){const task=tasks.find(t=>t.id==taskId);if(!task)return;pomodoroTaskId=taskId;document.getElementById('timerTask').innerText=task.task_name;document.getElementById('pomodoroModal').classList.remove('hidden');document.getElementById('pomodoroModal').classList.add('flex')}
        function closePomodoroModal(){if(isPomodoroRunning&&!confirm('Timer masih berjalan. Yakin mau tutup?'))return;pausePomodoro();resetPomodoro();document.getElementById('pomodoroModal').classList.add('hidden');document.getElementById('pomodoroModal').classList.remove('flex')}
        function setTimer(minutes){if(isPomodoroRunning)return;pomodoroSeconds=minutes*60;pomodoroTotalSeconds=minutes*60;updateTimerDisplay();updateTimerCircle()}
        function startPomodoro(){if(isPomodoroRunning)return;isPomodoroRunning=true;document.getElementById('timerStartBtn').classList.add('hidden');document.getElementById('timerPauseBtn').classList.remove('hidden');soundTimer.play();pomodoroInterval=setInterval(()=>{pomodoroSeconds--;updateTimerDisplay();updateTimerCircle();if(pomodoroSeconds<=0)completePomodoro()},1000)}
        function pausePomodoro(){if(!isPomodoroRunning)return;isPomodoroRunning=false;clearInterval(pomodoroInterval);document.getElementById('timerStartBtn').classList.remove('hidden');document.getElementById('timerPauseBtn').classList.add('hidden')}
        function resetPomodoro(){pausePomodoro();pomodoroSeconds=pomodoroTotalSeconds;updateTimerDisplay();updateTimerCircle()}
        function completePomodoro(){pausePomodoro();soundTimerEnd.play();confetti({particleCount:50,spread:60,origin:{y:0.6}});if(pomodoroTaskId){fetch('/api/api.php?action=pomodoro_complete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:pomodoroTaskId})}).then(res=>res.json()).then(json=>{if(json.status==='success'){tasks=json.data;saveLocal();render()}})}alert('üéâ Pomodoro selesai! Great work, Cheva!');resetPomodoro()}
        function updateTimerDisplay(){const minutes=Math.floor(pomodoroSeconds/60),seconds=pomodoroSeconds%60;document.getElementById('timerDisplay').innerText=`${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`}
        function updateTimerCircle(){const progress=pomodoroSeconds/pomodoroTotalSeconds,circumference=2*Math.PI*88,offset=circumference*(1-progress);document.getElementById('timerCircle').style.strokeDashoffset=offset}
        
        function openDueDateModal(taskId){const task=tasks.find(t=>t.id==taskId);if(!task)return;currentDueDateTaskId=taskId;document.getElementById('dueDateTaskName').innerText=task.task_name;document.getElementById('dueDateInput').value=task.due_date||'';document.getElementById('dueDateModal').classList.remove('hidden');document.getElementById('dueDateModal').classList.add('flex')}
        function closeDueDateModal(){currentDueDateTaskId=null;document.getElementById('dueDateModal').classList.add('hidden');document.getElementById('dueDateModal').classList.remove('flex')}
        function saveDueDate(){const dueDate=document.getElementById('dueDateInput').value;if(!currentDueDateTaskId)return;const task=tasks.find(t=>t.id==currentDueDateTaskId);if(task){task.due_date=dueDate||null;saveLocal();render()}fetch('/api/api.php?action=update_due_date',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:currentDueDateTaskId,due_date:dueDate||null})}).then(res=>res.json()).then(json=>{if(json.status==='success'){tasks=json.data;saveLocal();render();showSuccessToast(json.message||'Deadline berhasil diset!')}});closeDueDateModal()}
        function formatDueDate(dateStr){if(!dateStr)return'';const date=new Date(dateStr+'T00:00:00'),today=new Date();today.setHours(0,0,0,0);const dueDate=new Date(date);dueDate.setHours(0,0,0,0);const diffTime=dueDate-today,diffDays=Math.ceil(diffTime/(1000*60*60*24));if(diffDays<0)return'<span class="text-red-500 font-bold">Overdue!</span>';if(diffDays===0)return'<span class="text-amber-500 font-bold">Today</span>';if(diffDays===1)return'<span class="text-blue-500">Tomorrow</span>';if(diffDays<=7)return'<span class="text-slate-600 dark:text-slate-400">'+diffDays+' days</span>';return'<span class="text-slate-500">'+date.toLocaleDateString('id-ID',{day:'numeric',month:'short'})+'</span>'}
        function isDueSoon(dateStr){if(!dateStr)return false;const date=new Date(dateStr+'T00:00:00'),today=new Date();today.setHours(0,0,0,0);const dueDate=new Date(date);dueDate.setHours(0,0,0,0);const diffTime=dueDate-today,diffDays=Math.ceil(diffTime/(1000*60*60*24));return diffDays<=1}
        
        function updateStreakUI(streak){console.log('Updating Streak UI:',streak);streakData=streak||{current:0,longest:0,last_date:null};document.getElementById('currentStreak').innerText=streakData.current||0;document.getElementById('longestStreak').innerText=streakData.longest||0}
        function showStreakToast(streak){const toast=document.getElementById('streakToast'),text=document.getElementById('streakText');text.innerText=`${streak.current} hari berturut-turut! Keep it up!`;toast.style.opacity='1';toast.style.transform='translateX(-50%) translateY(0)';toast.classList.remove('pointer-events-none');setTimeout(()=>{toast.style.opacity='0';toast.style.transform='translateX(-50%) translateY(-1rem)';toast.classList.add('pointer-events-none')},3000)}
        function showStreakDetail(){alert(`üî• Streak Stats:\n\nCurrent: ${streakData.current} days\nLongest: ${streakData.longest} days\nLast active: ${streakData.last_date||'Never'}\n\n${streakData.current>=7?'üèÜ Amazing consistency!':'Keep going to build your streak!'}`)}
        function showMotivation(){const toast=document.getElementById('motivationToast'),text=document.getElementById('motivationText');text.innerText=motivationalQuotes[Math.floor(Math.random()*motivationalQuotes.length)];toast.style.opacity='1';toast.style.transform='translateX(-50%) translateY(0)';toast.classList.remove('pointer-events-none');soundCheer.currentTime=0;soundCheer.play().catch(e=>console.log('Audio play failed:',e));setTimeout(()=>{toast.style.opacity='0';toast.style.transform='translateX(-50%) translateY(-1rem)';toast.classList.add('pointer-events-none')},3000)}
        function showSuccessToast(message){const toast=document.getElementById('successToast'),messageEl=document.getElementById('successMessage');messageEl.innerText=message;toast.style.opacity='1';toast.style.transform='translateX(0)';toast.classList.remove('pointer-events-none');setTimeout(()=>{toast.style.opacity='0';toast.style.transform='translateX(100%)';toast.classList.add('pointer-events-none')},3000)}
        
        if(localStorage.getItem('theme')==='dark'){document.documentElement.classList.add('dark');document.getElementById('themeIcon').classList.replace('ph-moon-stars','ph-sun')}
        
        async function init(){renderDate();const cached=localStorage.getItem('cheva_tasks');if(cached)tasks=JSON.parse(cached);const cachedAuth=localStorage.getItem('cheva_auth');if(cachedAuth==='true'){isLoggedIn=true;updateAuthUI(true)}else{updateAuthUI(false)}render();try{const res=await fetch('/api/api.php?action=get_all');const json=await res.json();console.log('Init API Response:',json);if(json.status==='locked'){isLoggedIn=false;localStorage.setItem('cheva_auth','false');updateAuthUI(false)}else{isLoggedIn=true;localStorage.setItem('cheva_auth','true');updateAuthUI(true);tasks=json.data||[];saveLocal();if(json.streak){console.log('Streak from init:',json.streak);updateStreakUI(json.streak)}render()}}catch(e){console.log("Offline mode or API error",e)}}
        function updateAuthUI(status){const body=document.body,overlay=document.getElementById('teaserOverlay');if(status){body.classList.remove('mode-teaser');overlay.classList.remove('flex');overlay.classList.add('hidden')}else{body.classList.add('mode-teaser');overlay.classList.remove('hidden');overlay.classList.add('flex')}}
        function saveLocal(){localStorage.setItem('cheva_tasks',JSON.stringify(tasks))}
        function renderDate(){const options={weekday:'long',day:'numeric',month:'long'};document.getElementById('dateDisplay').innerText=new Date().toLocaleDateString('id-ID',options)}
        
        function render(){const listEl=document.getElementById('todoList'),emptyState=document.getElementById('emptyState'),focusMsg=document.getElementById('focusStateMsg'),searchTerm=document.getElementById('searchInput').value.toLowerCase();let renderTasks=[...tasks].sort((a,b)=>a.list_order-b.list_order);if(searchTerm)renderTasks=renderTasks.filter(t=>t.task_name.toLowerCase().includes(searchTerm));if(isFocusMode&&focusTaskId){const focusTask=renderTasks.find(t=>t.id==focusTaskId);renderTasks=focusTask?[focusTask]:[];focusMsg.classList.remove('hidden');if(focusTask)document.getElementById('focusTaskName').innerText=`"${focusTask.task_name}"`}else{focusMsg.classList.add('hidden')}listEl.innerHTML='';if(renderTasks.length===0&&!searchTerm&&!isFocusMode){emptyState.classList.remove('hidden');document.getElementById('quoteText').innerText=quotes[Math.floor(Math.random()*quotes.length)]}else{emptyState.classList.add('hidden');renderTasks.forEach((t,i)=>{const delay=i<10?`animation-delay: ${i*50}ms`:'',borderStyle=t.category_color&&t.category_color!=='transparent'?`border-left-color: ${t.category_color}`:'',dueSoonClass=t.due_date&&isDueSoon(t.due_date)?'ring-2 ring-red-500/50':'',li=document.createElement('li');li.className=`group relative bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm p-4 rounded-2xl border border-white dark:border-slate-700 shadow-sm flex items-center gap-4 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:bg-white dark:hover:bg-slate-700 ${t.is_completed==1?'opacity-60 scale-98 grayscale':'animate-slide-up'} ${dueSoonClass}`;li.style=`${delay}; ${borderStyle}; border-left-width: 4px;`;li.setAttribute('data-id',t.id);const pomodoroCount=t.pomodoro_count?`<span class="text-xs text-slate-400">üçÖ ${t.pomodoro_count}</span>`:'',dueDateDisplay=t.due_date?`<span class="text-xs ml-2">${formatDueDate(t.due_date)}</span>`:'';li.innerHTML=`<div class="relative w-6 h-6 flex-shrink-0"><input type="checkbox" class="custom-checkbox w-full h-full appearance-none border-2 border-slate-300 dark:border-slate-500 rounded-lg checked:bg-accent checked:border-accent cursor-pointer transition-all" ${t.is_completed==1?'checked':''} onchange="toggleTask(${t.id}, this)"></div><div class="flex-grow"><span class="font-semibold text-slate-700 dark:text-slate-200 text-sm sm:text-base break-words transition-all block ${t.is_completed==1?'line-through text-slate-400 italic':''}">${t.task_name}</span><div class="flex items-center gap-2 mt-1">${pomodoroCount}${dueDateDisplay}</div></div><div class="flex gap-2 items-center">${!t.is_completed?`<button onclick="openPomodoroModal(${t.id})" class="w-8 h-8 rounded-lg bg-orange-50 dark:bg-orange-900/30 flex items-center justify-center text-orange-500 hover:bg-orange-100 transition opacity-0 group-hover:opacity-100" title="Pomodoro"><i class="ph-bold ph-timer"></i></button><button onclick="openDueDateModal(${t.id})" class="w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center text-blue-500 hover:bg-blue-100 transition opacity-0 group-hover:opacity-100" title="Set Deadline"><i class="ph-bold ph-calendar"></i></button>`:''}<div class="item-actions ${isEditMode?'flex':'hidden'} gap-2"><div class="drag-handle w-8 h-8 rounded-lg bg-slate-100 dark:bg-slate-600 flex items-center justify-center cursor-grab text-slate-500 hover:text-accent"><i class="ph-bold ph-dots-six-vertical"></i></div><div onclick="deleteTask(${t.id})" class="w-8 h-8 rounded-lg bg-red-50 dark:bg-red-900/30 flex items-center justify-center cursor-pointer text-red-500 hover:bg-red-500 hover:text-white transition"><i class="ph-bold ph-trash"></i></div></div></div>`;listEl.appendChild(li)})}updateStats()}
        
        function toggleTask(id,cb){const task=tasks.find(t=>t.id==id);if(task){if(navigator.vibrate)navigator.vibrate(15);const wasChecked=task.is_completed==1;if(cb.checked){soundCheck.currentTime=0;soundCheck.play().catch(e=>console.log('Audio play failed:',e));showMotivation()}task.is_completed=cb.checked?1:0;saveLocal();render();console.log('Toggle Task - ID:',id,'Checked:',cb.checked,'Was:',wasChecked);fetch('/api/api.php?action=toggle',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})}).then(res=>{console.log('Response Status:',res.status);return res.text()}).then(text=>{console.log('Response Text:',text);try{const json=JSON.parse(text);console.log('Toggle Response Full:',json);if(json.status==='success'&&json.data){tasks=json.data;saveLocal();render();if(json.streak){console.log('OLD Streak:',streakData,'NEW Streak:',json.streak);const oldStreak=streakData.current;updateStreakUI(json.streak);if(json.streak.current>oldStreak&&cb.checked){showStreakToast(json.streak)}else if(json.streak.current<oldStreak&&!cb.checked){console.log('Streak decreased from',oldStreak,'to',json.streak.current)}}}}catch(e){console.error('JSON Parse Error:',e,'Raw text:',text)}}).catch(err=>console.error('Fetch Error:',err))}}
        function updateStats(){const total=tasks.length,completed=tasks.filter(t=>t.is_completed==1).length,percent=total===0?0:Math.round((completed/total)*100),bar=document.getElementById('progressBar'),txt=document.getElementById('progressText');bar.style.width=`${percent}%`;txt.innerText=`${percent}%`;if(percent===100&&total>0){if(!localStorage.getItem('celebrated')){launchConfetti();soundComplete.play();localStorage.setItem('celebrated','true')}}else{localStorage.removeItem('celebrated')}}
        function addTask(){const input=document.getElementById('newTaskInput'),val=input.value.trim(),color=document.querySelector('input[name="cat"]:checked').value;if(val){const tempId=Date.now(),newTask={id:tempId,task_name:val,is_completed:0,list_order:tasks.length,category_color:color,due_date:null,pomodoro_count:0,completed_date:null};tasks.push(newTask);saveLocal();render();input.value='';fetch('/api/api.php?action=add',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({task:val,color:color})}).then(res=>res.json()).then(json=>{if(json.status==='success'){tasks=json.data;saveLocal();render();showSuccessToast(json.message||'Tugas berhasil ditambahkan!')}})}}
        
        function initSortable(){const el=document.getElementById('todoList');if(!sortableInstance){sortableInstance=Sortable.create(el,{animation:150,handle:'.drag-handle',ghostClass:'opacity-50',onEnd:function(evt){const movedItem=tasks.splice(evt.oldIndex,1)[0];tasks.splice(evt.newIndex,0,movedItem);tasks.forEach((t,i)=>t.list_order=i);saveLocal();render();const orderIds=tasks.map(t=>t.id);fetch('/api/api.php?action=reorder',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({order:orderIds})}).then(res=>res.json()).then(json=>{if(json.status==='success'){tasks=json.data;saveLocal()}})}})}}
        function destroySortable(){if(sortableInstance){sortableInstance.destroy();sortableInstance=null}}
        
        function toggleFocusMode(){if(!isLoggedIn)return openLogin();if(!isFocusMode){openFocusSelector()}else{isFocusMode=false;focusTaskId=null;document.getElementById('focusBtn').classList.remove('text-accent','bg-indigo-50');render()}}
        function openFocusSelector(){const modal=document.getElementById('focusSelectorModal'),listEl=document.getElementById('focusTaskList'),incompleteTasks=tasks.filter(t=>t.is_completed==0);if(incompleteTasks.length===0){alert('Tidak ada tugas yang belum selesai!');return}listEl.innerHTML='';incompleteTasks.forEach(t=>{const borderStyle=t.category_color&&t.category_color!=='transparent'?`border-left-color: ${t.category_color}`:'',div=document.createElement('div');div.className='p-4 bg-slate-50 dark:bg-slate-700 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-600 cursor-pointer transition';div.style=borderStyle+'; border-left-width: 4px;';div.innerHTML=`<p class="font-semibold text-sm">${t.task_name}</p>${t.due_date?`<p class="text-xs text-slate-500 mt-1">${formatDueDate(t.due_date)}</p>`:''}`;div.onclick=()=>selectFocusTask(t.id);listEl.appendChild(div)});modal.classList.remove('hidden');modal.classList.add('flex')}
        function closeFocusSelector(){document.getElementById('focusSelectorModal').classList.add('hidden');document.getElementById('focusSelectorModal').classList.remove('flex')}
        function selectFocusTask(taskId){isFocusMode=true;focusTaskId=taskId;document.getElementById('focusBtn').classList.add('text-accent','bg-indigo-50');closeFocusSelector();render()}
        
        function launchConfetti(){confetti({particleCount:100,spread:70,origin:{y:0.6},colors:['#6366f1','#a855f7','#ec4899']})}
        function toggleEditMode(){if(!isLoggedIn)return openLogin();isEditMode=!isEditMode;const panel=document.getElementById('adminPanel'),btn=document.getElementById('profileBtn');if(isEditMode){panel.classList.remove('hidden');panel.classList.add('flex');btn.classList.add('bg-indigo-500','text-white','border-transparent');initSortable()}else{panel.classList.add('hidden');panel.classList.remove('flex');btn.classList.remove('bg-indigo-500','text-white','border-transparent');destroySortable()}render()}
        function toggleDarkMode(){document.documentElement.classList.toggle('dark');const isDark=document.documentElement.classList.contains('dark');localStorage.setItem('theme',isDark?'dark':'light');document.getElementById('themeIcon').className=isDark?'ph-bold ph-sun text-xl':'ph-bold ph-moon-stars text-xl'}
        function togglePass(){const inp=document.getElementById('passwordInput'),ico=document.getElementById('eyeIcon');if(inp.type==='password'){inp.type='text';ico.className='ph ph-eye-slash absolute right-4 top-1/2 -translate-y-1/2 text-xl text-accent cursor-pointer'}else{inp.type='password';ico.className='ph ph-eye absolute right-4 top-1/2 -translate-y-1/2 text-xl text-slate-400 cursor-pointer'}}
        
        function openLogin(){document.getElementById('loginModal').classList.remove('hidden');document.getElementById('loginModal').classList.add('flex');setTimeout(()=>document.getElementById('passwordInput').focus(),100)}
        function closeModal(){document.getElementById('loginModal').classList.add('hidden');document.getElementById('loginModal').classList.remove('flex');document.getElementById('errorMsg').classList.add('hidden');document.getElementById('passwordInput').value=''}
        async function attemptLogin(){const pass=document.getElementById('passwordInput').value;if(!pass)return;try{const res=await fetch('/api/api.php?action=login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:pass})});const json=await res.json();console.log('Login Response:',json);if(json.status==='success'){isLoggedIn=true;localStorage.setItem('cheva_auth','true');updateAuthUI(true);closeModal();tasks=json.data||[];saveLocal();if(json.streak){console.log('Streak from login:',json.streak);updateStreakUI(json.streak)}render()}else{document.getElementById('errorMsg').classList.remove('hidden');document.getElementById('passwordInput').value=''}}catch(e){alert('Error: '+e.message)}}
        function logout(){if(!confirm('Yakin mau logout?'))return;isLoggedIn=false;isEditMode=false;localStorage.setItem('cheva_auth','false');updateAuthUI(false);document.getElementById('adminPanel').classList.add('hidden');document.getElementById('profileBtn').classList.remove('bg-indigo-500','text-white','border-transparent');destroySortable();fetch('/api/api.php?action=logout',{method:'POST'}).then(res=>res.json()).then(json=>console.log('Logged out from server'))}
        function deleteTask(id){if(!confirm('Yakin mau hapus tugas ini?'))return;tasks=tasks.filter(t=>t.id!=id);saveLocal();render();fetch('/api/api.php?action=delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})}).then(res=>res.json()).then(json=>{if(json.status==='success'){tasks=json.data;saveLocal();render();showSuccessToast(json.message||'Tugas berhasil dihapus!');if(json.streak){updateStreakUI(json.streak)}}})}
        function apiCallWithConfirm(action,payload,confirmMsg){if(!confirm(confirmMsg))return;fetch(`/api/api.php?action=${action}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).then(res=>res.json()).then(json=>{if(json.status==='success'){tasks=json.data||[];saveLocal();render();showSuccessToast(json.message||'Berhasil!');if(json.streak){console.log('Streak from',action,':',json.streak);updateStreakUI(json.streak)}}})}
        
        init();
    </script>
</body>
</html>