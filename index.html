<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheva's To Do List</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            --accent-color: #8B5CF6;
            --glass-bg: rgba(255, 255, 255, 0.8);
            --text-dark: #1e293b;
            --text-gray: #64748b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #f3f4f6; color: var(--text-dark);
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
        }
        /* Background Blobs */
        .blob { position: fixed; border-radius: 50%; filter: blur(60px); z-index: -1; opacity: 0.5; }
        .b1 { width: 300px; height: 300px; background: #c084fc; top: -50px; left: -50px; }
        .b2 { width: 250px; height: 250px; background: #60a5fa; bottom: -50px; right: -50px; }

        .container {
            width: 90%; max-width: 500px; background: var(--glass-bg); backdrop-filter: blur(15px);
            border-radius: 24px; padding: 2rem; box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .brand { font-family: 'Outfit'; font-size: 1.8rem; font-weight: 800; line-height: 1; }
        .highlight { background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .profile-btn { 
            width: 45px; height: 45px; border-radius: 12px; border: none; cursor: pointer; 
            background: white; color: var(--text-gray); transition: 0.3s;
        }
        .profile-btn.active { background: var(--primary-gradient); color: white; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4); }

        /* Login Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(8px); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-card { background: white; padding: 2rem; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; }
        .pass-container { position: relative; margin: 1.5rem 0; }
        .pass-container input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; outline: none; }
        .toggle-pass { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-gray); }

        /* Admin Panel */
        .admin-panel { background: white; padding: 1rem; border-radius: 15px; margin-bottom: 1.5rem; display: none; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .input-group { display: flex; gap: 8px; margin-bottom: 10px; }
        .input-group input { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #eee; }
        .btn-add { background: var(--text-dark); color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; }
        .tools { display: flex; gap: 5px; flex-wrap: wrap; }
        .btn-tool { font-size: 0.75rem; padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer; }

        /* List */
        ul { list-style: none; display: flex; flex-direction: column; gap: 10px; }
        .todo-item { background: white; padding: 12px 15px; border-radius: 12px; display: flex; align-items: center; transition: 0.2s; }
        .todo-item.completed { opacity: 0.6; background: #f9fafb; }
        .todo-item.completed .task-text { text-decoration: line-through; color: #94a3b8; }
        .task-text { flex: 1; margin: 0 10px; font-weight: 500; }
        .item-actions { display: none; gap: 5px; } /* Muncul di Edit Mode */
        .edit-mode .item-actions { display: flex; }
        .action-btn { cursor: pointer; color: var(--text-gray); }

        .btn-login { background: var(--primary-gradient); color: white; border: none; width: 100%; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; }
    </style>
</head>
<body>
    <div class="blob b1"></div><div class="blob b2"></div>

    <div id="loginModal" class="modal">
        <div class="modal-card">
            <h2 style="font-family:'Outfit'">Private Access</h2>
            <div class="pass-container">
                <input type="password" id="passInput" placeholder="Masukkan password...">
                <i class="ph ph-eye toggle-pass" id="eyeIcon" onclick="togglePasswordVisibility()"></i>
            </div>
            <p id="errorMsg" style="color:red; font-size:0.8rem; margin-bottom:10px; display:none;">Password salah!</p>
            <button class="btn-login" onclick="login()">Buka List</button>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="brand"><span class="highlight">Cheva's</span><br>To Do List</div>
            <button class="profile-btn" id="profileBtn" onclick="toggleEditMode()">
                <i class="ph ph-user-gear" style="font-size: 24px;"></i>
            </button>
        </header>

        <div class="admin-panel" id="adminPanel">
            <div class="input-group">
                <input type="text" id="taskInput" placeholder="Tugas baru...">
                <button class="btn-add" onclick="addTask()">Tambah</button>
            </div>
            <div class="tools">
                <button class="btn-tool" style="background:#dbeafe" onclick="api('uncheck_all')">Uncheck All</button>
                <button class="btn-tool" style="background:#fef3c7" onclick="api('clear_completed')">Clear Done</button>
                <button class="btn-tool" style="background:#fee2e2" onclick="api('reset')">Reset</button>
                <button class="btn-tool" style="background:#f1f5f9" onclick="logout()">Logout</button>
            </div>
        </div>

        <ul id="todoList"></ul>
    </div>

    <script>
        let tasks = [];
        let isEditMode = false;

        async function init() {
            const res = await fetch('/api/api.php?action=get_all');
            const json = await res.json();
            if (json.status === 'success') {
                tasks = json.data;
                render();
            } else {
                document.getElementById('loginModal').style.display = 'flex';
            }
        }

        function togglePasswordVisibility() {
            const input = document.getElementById('passInput');
            const icon = document.getElementById('eyeIcon');
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'ph ph-eye-closed toggle-pass';
            } else {
                input.type = 'password';
                icon.className = 'ph ph-eye toggle-pass';
            }
        }

        async function login() {
            const pass = document.getElementById('passInput').value;
            const res = await fetch('/api/api.php?action=login', {
                method: 'POST',
                body: JSON.stringify({ password: pass })
            });
            const json = await res.json();
            if (json.status === 'success') location.reload();
            else document.getElementById('errorMsg').style.display = 'block';
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            document.getElementById('adminPanel').style.display = isEditMode ? 'block' : 'none';
            document.getElementById('profileBtn').classList.toggle('active', isEditMode);
            render();
        }

        async function api(action, data = {}) {
            await fetch(`/api/api.php?action=${action}`, {
                method: 'POST',
                body: JSON.stringify(data)
            });
            init();
        }

        function render() {
            const list = document.getElementById('todoList');
            list.className = isEditMode ? 'edit-mode' : '';
            list.innerHTML = tasks.map((t, i) => `
                <li class="todo-item ${t.is_completed ? 'completed' : ''}">
                    <input type="checkbox" ${t.is_completed ? 'checked' : ''} onchange="api('toggle', {id:${t.id}})">
                    <span class="task-text">${t.task_name}</span>
                    <div class="item-actions">
                        <i class="ph ph-arrow-up action-btn" onclick="move(${i}, -1)"></i>
                        <i class="ph ph-arrow-down action-btn" onclick="move(${i}, 1)"></i>
                        <i class="ph ph-trash action-btn" style="color:red" onclick="api('delete', {id:${t.id}})"></i>
                    </div>
                </li>
            `).join('');
        }

        function move(idx, dir) {
            if (idx + dir < 0 || idx + dir >= tasks.length) return;
            const t1 = tasks[idx], t2 = tasks[idx + dir];
            api('swap', { id1: t1.id, order1: t1.list_order, id2: t2.id, order2: t2.list_order });
        }

        function addTask() {
            const val = document.getElementById('taskInput').value;
            if (val) { api('add', { task: val }); document.getElementById('taskInput').value = ''; }
        }

        function logout() { fetch('/api/api.php?action=logout').then(() => location.reload()); }

        init();
    </script>
</body>
</html>